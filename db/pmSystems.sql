-- phpMyAdmin SQL Dump
-- version 4.0.10.7
-- http://www.phpmyadmin.net
--
-- Host: localhost
-- Generation Time: Apr 21, 2015 at 08:57 PM
-- Server version: 5.5.42-cll
-- PHP Version: 5.4.23

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;

--
-- Database: `howlate_main`
--

--
-- Dumping data for table `pmsystems`
--

INSERT INTO `pmsystems` (`ID`, `Company`, `Name`, `AnnualRevenue`, `Certification`, `Website`, `Timestamp`, `Priority`, `Implemented`, `SelectSessions`, `SelectLates`, `SelectToNotify`, `Agent32Bit`, `ConnectionString`, `ImplemNotes`) VALUES
(1, 'Best Practice Software', 'BestPractice 1.8+', '?', '', 'http://bpsoftware.com.au', '2014-12-11 01:08:24', 100, 1, 'select * from BPS_Sessions where Provider <> ''''', 'SELECT a1.Provider, a1.Status, a1.ArrivalTime, a1.AppointmentDate, a1.AppointmentTime, a1.ConsultationTime, a1.AppointmentLength, 7200 As Horizon \nFROM BPS_Appointments a1, BPS_Sessions b1 \nWHERE a1.AppointmentDate = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE()))\nAND a1.ConsultationTime = \n(SELECT MAX(a2.ConsultationTime) FROM BPS_Appointments a2 \nWHERE a2.AppointmentDate = a1.AppointmentDate AND a2.Provider \n= a1.Provider AND a2.ConsultationTime != 0)\nAND a1.Provider = b1.Provider\nAND b1.Day = DATENAME(dw,GETDATE())\nAND b1.EndTime + 7200 > DATEDIFF(s, 0,DATEADD(Day, 0 - DATEDIFF(Day, 0, GETDATE()), GETDATE()))', 'select a1.Patient, a1.InternalID, a1.AppointmentDate, a1.AppointmentTime, a1.Provider, p.MobilePhone, a1.Status, a1.AppointmentLength, @ConsultationTime As ConsultationTime from BPS_Appointments a1\ninner join BPS_Patients p on p.InternalID = a1.InternalID\ninner join PATIENTS ON PATIENTS.INTERNALID = p.InternalID\nwhere a1.ArrivalTime = 0 and a1.Provider = @Provider and p.MobilePhone <> '''' and PATIENTS.CONSENTSMSREMINDER = 1\nand a1.Status <> ''Waiting''\nand (\n (a1.AppointmentDate = @AppointmentDate\nand a1.AppointmentTime > @AppointmentTime\nand a1.AppointmentTime <= @AppointmentTime + @Horizon)\n or\n (@AppointmentTime > (84600 - @Horizon) and a1.AppointmentDate = DATEADD(day,1,@AppointmentDate) \n  and a1.AppointmentTime < @AppointmentTime - 86400 + @Horizon\n )\n)\nand \na1.InternalID NOT IN (select a2.InternalID from BPS_Appointments a2\nWHERE a2.InternalID = a1.InternalID\nAND a2.Provider <> a1.Provider\nAND a2.AppointmentDate = a1.AppointmentDate\nAND a2.AppointmentTime < a1.AppointmentTime\n)\nORDER BY a1.AppointmentTime', 0, '', ''),
(2, 'Medical Director', 'Medical Director 3.15+', '?', '', 'http://hcn.com.au', '2014-12-11 01:08:24', 100, 1, 'select * from SESSION where 1 = 0', 'select a1.PractitionerID, [Name] As Provider, a1.[When] As AppointmentTime, a1.[TimeInWAITROOM] As ArrivalTime, a1.TimeInConsult As ConsultationTime,\r\nDATEDIFF(minute,TimeInWAITROOM, TimeInConsult) As NewLate,\r\n2 As Horizon\r\nfrom APPT a1, PRAC\r\nwhere a1.PractitionerID = PRAC.PractitionerID \r\nand DATEADD(dd, 0, DATEDIFF(dd, 0, [When])) = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE()))\r\nand TimeInConsult = \r\n(SELECT MAX(TimeInConsult) FROM APPT a2\r\n WHERE a2.PractitionerID = a1.PractitionerID\r\n and DATEADD(dd, 0, DATEDIFF(dd, 0, a1.[When])) = DATEADD(dd, 0, DATEDIFF(dd, 0, a2.[When])) \r\n and TimeInConsult is not null)\r\nand DATEPART(hour,GETDATE()) <= \r\n  (SELECT MAX(DATEPART(hour,b2.[1End]) + 2)\r\n   FROM SESSION b2\r\n   WHERE b2.DayOfWk = DATEPART(weekday,GETDATE())\r\n   AND (b2.PractitionerID = 0 or b2.PractitionerID = a1.PractitionerID)\r\n  )\r\n', 'select a1.PatientID, p.SURNAME, a1.[When] As AppointmentDate, p.PHONE_MOBILE As MobilePhone from APPT a1\r\ninner join CM_PATIENT p on p.PATIENT_ID = a1.PatientID\r\nwhere a1.TimeInWAITROOM is null and a1.PractitionerID = @PractitionerID and p.PHONE_MOBILE <> ''''\r\nand a1.[When] > @AppointmentTime and a1.[When] < DATEADD(hour, @Horizon, @AppointmentTime)\r\n', 0, '', ''),
(120, 'MedTech Global', 'MedTech 32', '', '', 'http://medtechglobal.com/au/', '2014-12-11 03:50:14', 100, 1, 'select \nCASE EXTRACT(WEEKDAY FROM AH.APPDATE)\n  WHEN 0 THEN ''Sunday''\n  WHEN 1 THEN ''Monday''\n  WHEN 2 THEN ''Tuesday''\n  WHEN 3 THEN ''Wednesday''\n  WHEN 4 THEN ''Thursday''\n  WHEN 5 THEN ''Friday''\n  WHEN 6 THEN ''Saturday''\nEND As "Day",\nEXTRACT(HOUR FROM ATH.DAYSTARTTIME) * 3600 + EXTRACT(MINUTE FROM ATH.DAYSTARTTIME) * 60 AS StartTime,\nEXTRACT(HOUR FROM ATH.DAYENDTIME) * 3600 + EXTRACT(MINUTE FROM ATH.DAYENDTIME) * 60 AS EndTime,\np.NAMEEXTERN As Provider\nFROM APPHDR AH\nINNER JOIN APPTEMPHDR ATH ON ATH.APPTEMPKEY = AH.APPTEMPKEY\nINNER JOIN PROVIDER p ON p.PROVCODE = AH.PROVCODE\nWHERE  AH.APPDATE >= CURRENT_DATE\nAND AH.APPDATE < CURRENT_DATE + 7\nAND ATH.DAYOFF = 0', 'SELECT p.NAMEEXTERN As Provider, '''' As Status,\nEXTRACT(HOUR FROM a1.WHENARRIVED) * 3600 + EXTRACT(MINUTE FROM a1.WHENARRIVED) * 60 + EXTRACT(SECOND FROM a1.WHENARRIVED) As ArrivalTime,\nCAST(a1.WHENARRIVED As Date) As AppointmentDate,\nEXTRACT(HOUR FROM a1.WHENAPPOINT) * 3600 + EXTRACT(MINUTE FROM a1.WHENAPPOINT) * 60 + EXTRACT(SECOND FROM a1.WHENAPPOINT) As AppointmentTime,\nEXTRACT(HOUR FROM a1.WHENCONSULT) * 3600 + EXTRACT(MINUTE FROM a1.WHENCONSULT) * 60 + EXTRACT(SECOND FROM a1.WHENCONSULT) As ConsultationTime,\nEXTRACT(HOUR FROM a1.DURATION) * 3600    + EXTRACT(MINUTE FROM a1.DURATION) * 60    + EXTRACT(SECOND FROM a1.DURATION)    As AppointmentLength,\n7200 As Horizon, (a1.WhenConsult - a1.WhenAppoint) * 24 * 60 As NewLate\nfrom APPLINE a1\ninner join PROVIDER p ON p.PROVCODE = a1.PROVCODE\nwhere a1.WHENAPPOINT >= CURRENT_DATE\nand CAST(a1.WHENAPPOINT As Date) = CURRENT_DATE\nand a1.WHENCONSULT = (\nSELECT MAX(a2.WHENCONSULT) FROM APPLINE a2, APPHDR AH, APPTEMPHDR ATH\nWHERE a2.WHENAPPOINT >= CURRENT_DATE AND a2.WHENAPPOINT < CURRENT_DATE + 1\nAND a2.PROVCODE = a1.PROVCODE\nAND AH.PROVCODE = a2.PROVCODE\nAND AH.APPDATE = CURRENT_DATE\nAND ATH.APPTEMPKEY = AH.APPTEMPKEY\nAND CURRENT_TIME < CAST(ATH.DAYENDTIME As TIME) + 7200\n)', 'select ab.PREFORMATTEDEXTERN As Patient, ab.ANYBODYID As InternalID, CAST(a1.WHENAPPOINT As Date) As AppointmentDate,\na1.WHENAPPOINT As AppointmentTime, prov.NAMEEXTERN As Provider, ab.CELLPHONE As MobilePhone,\n(CASE WHEN a1.WHENARRIVED IS NULL THEN ''Not Arrived'' ELSE ''Waiting'' END) AS Status,\nCAST(a1.DURATION As TIME) As AppointmentDuration\nfrom APPLINE a1\ninner join ANYBODY ab on ab.ANYBODYID = a1.ANYBODYID\ninner join PATIENT p on p.PATIENTID = ab.ANYBODYID\ninner join PROVIDER prov ON prov.PROVCODE = a1.PROVCODE\nWHERE prov.NAMEEXTERN = @Provider\nAND ab.CELLPHONE <> ''''\nAND p.NOSMS = 0\nAND a1.WHENAPPOINT >= CURRENT_DATE\nAND a1.WHENAPPOINT < CURRENT_DATE + 1\nAND a1.WHENAPPOINT > @AppointmentTime\nAND a1.WHENAPPOINT > CURRENT_TIMESTAMP\nAND a1.WHENAPPOINT <= CURRENT_TIMESTAMP + (cast(''2:00'' as time)-cast(''0:00'' as time))/(60*60*24)\nAND a1.ANYBODYID NOT IN (select a2.ANYBODYID from APPLINE a2\nWHERE a2.ANYBODYID = a1.ANYBODYID\nAND a2.PROVCODE <> a1.PROVCODE\nAND CAST(a2.WHENAPPOINT As Date) = CAST(a1.WHENAPPOINT As Date)\nAND a2.WHENAPPOINT < a1.WHENAPPOINT\n)', 1, '', ''),
(126, 'ZedMed', 'ZedMed', '?', '', 'http://www.zedmed.com.au/', '2015-02-04 06:39:12', 99, 1, '', '', '', 0, '', ''),
(127, 'Genie', 'Genie', '', '', 'http://www.geniesolutions.com.au/', '2015-02-04 06:39:12', 99, 1, 'SELECT Id FROM ApptBlock', 'Select a1.StartTime, PT_Id_Fk As Patient, a1.ProviderName As Provider, ApptStatus.Status As Status, 86400 + CAST(a1.ArrivalTime AS INT) / 1000 As ArrivalTime, a1.StartDate As AppointmentDate, CAST(a1.StartTime AS INT) / 1000 As AppointmentTime, (CAST(SUBSTRING(a1.LastUpdated,9,2) As Int) * 3600 + CAST(SUBSTRING(a1.LastUpdated,11,2) As Int) * 60 + CAST(SUBSTRING(a1.LastUpdated,13,2) As Int)) / (1 + 0) As ConsultationTimeUTC, ApptDuration As AppointmentLength, ''7200'' As Horizon\nFrom Appt a1\ninner join ApptStatus on ApptStatus.Id = a1.Status\nwhere DATE_TO_CHAR(CURRENT_TIMESTAMP(),''yyyyMmDd'') = DATE_TO_CHAR(a1.StartDate,''yyyyMmDd'')\nand ApptStatus.Status = ''In With Doctor''\nand a1.ProviderName not in /* if doctor has had a later appt today which has resulted in a consultation */\n(SELECT a2.ProviderName FROM Appt a2\nINNER JOIN ApptStatus as2 ON as2.Id = a2.Status\nLEFT OUTER JOIN Consult c2 ON c2.PT_Id_Fk = a2.PT_Id_Fk AND c2.ConsultDate = a2.StartDate\nWHERE a2.ProviderName = a1.ProviderName\nand a2.StartDate = a1.StartDate\nand a2.StartTime > a1.StartTime\nand c2.ConsultDate = a2.StartDate)', '', 1, 'DRIVER={4D v13 DC Driver};UID={Dr A Demo};PWD={123456a};Port=19812;Server=epicorserver', 'Q: Set SQL engine to auto-start, Q: How to set the ODBC user password.'),
(128, 'Rx', 'Rx', '', '', '', '2015-03-16 00:00:23', 100, 1, 'SELECT \nd.doc_given + '' '' + d.doc_family             AS ''Provider'', \nDatename(dw, t.blo_begin)                    AS Day, \nDateadd(dd, 0, Datediff(dd, 0, t.blo_begin)) AS DateOfSession, \nMin(Datediff(second, LEFT(CONVERT(VARCHAR(20), t.blo_begin, 126), 10),t.blo_begin)) AS StartTime, \nMax(Datediff(second, LEFT(CONVERT(VARCHAR(20), t.blo_end, 126), 10),t.blo_end)) AS EndTime \nFROM timeblock t \nINNER JOIN doctor d ON d.doc_id = t.blo_doc_id \nWHERE t.blo_begin < Dateadd(dd, 7, Datediff(dd, 0, Getdate())) \nAND t.blo_begin >= Dateadd(dd, 0, Datediff(dd, 0, Getdate())) \nGROUP BY d.doc_given + '' '' + d.doc_family, \nDatename(dw, t.blo_begin),\nDateadd(dd, 0, Datediff(dd, 0, t.blo_begin))', 'SELECT a1.APT_DOC_ID AS DOC_ID, d.DOC_GIVEN + '' '' + d.DOC_FAMILY As Provider,\nst.AST_SHORT AS Status,\nDATEDIFF(second, left(convert(varchar(20), APT_ARRIVED, 126), 10), APT_ARRIVED) As ArrivalTime,\nDATEADD(dd, 0, DATEDIFF(dd, 0, a1.APT_BEGIN)) As AppointmentDate,\nDATEDIFF(second, left(convert(varchar(20), APT_BEGIN, 126), 10), APT_BEGIN) As AppointmentTime,\nDATEDIFF(second, left(convert(varchar(20), a1.APT_CONSULTATION_TIME, 126), 10), a1.APT_CONSULTATION_TIME) As ConsultationTime,\n7200 As Horizon\nFROM APPOINTMENT a1\n JOIN DOCTOR d ON d.DOC_ID = a1.APT_DOC_ID\n JOIN REF_APPOINT_STATUS st ON st.AST_ID = a1.APT_STATUS_ID\n JOIN TIMEBLOCK b1 ON b1.BLO_DOC_ID = a1.APT_DOC_ID\nWHERE a1.APT_BEGIN >= DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE())) -- would help if there was an idx on APT_BEGIN!!!\nAND DATEADD(dd, 0, DATEDIFF(dd, 0, APT_BEGIN)) = DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE()))\nAND st.AST_SHORT NOT IN (''Arrived'',''Remark'',''Blank Appointment'')\nAND DATEADD(dd, 0, DATEDIFF(dd, 0, b1.BLO_BEGIN)) = DATEADD(dd, 0, DATEDIFF(dd, 0, APT_BEGIN))\nAND a1.APT_ARRIVED IS NULL\nAND (\n  (a1.APT_CONSULTATION_TIME = (SELECT MAX(a3.APT_CONSULTATION_TIME) FROM APPOINTMENT a3 \n  WHERE a3.APT_DOC_ID = a1.APT_DOC_ID \n  AND DATEADD(dd, 0, DATEDIFF(dd, 0, a3.APT_BEGIN)) = DATEADD(dd, 0, DATEDIFF(dd, 0, a1.APT_BEGIN))))\n\n  OR (a1.APT_CONSULTATION_TIME IS NULL AND st.AST_SHORT = ''In consultation'')  \n)', 'SELECT a1.APT_PAT_NAME AS Patient, a1.APT_PAT_ID AS InternalID, \na1.APT_BEGIN As AppointmentDate, a1.APT_BEGIN As AppointmentTime, \nd.DOC_GIVEN + '' '' + d.DOC_FAMILY As Provider, \ne.ENT_MPHONE As MobilePhone, \na1.APT_STATUS_ID AS Status, \nDATEDIFF(second, a1.APT_BEGIN, a1.APT_END) As AppointmentLength\n-- @ConsultationTime As ConsultationTime UNCOMMENT TIME\nfrom APPOINTMENT a1\ninner join ENTITY e on e.ENT_ID = a1.APT_PAT_ID\ninner join DOCTOR d ON d.DOC_ID = a1.APT_DOC_ID\ninner join PATIENT p ON p.PAT_ID = e.ENT_ID\nwhere a1.APT_ARRIVED IS NULL \nand a1.APT_DOC_ID = @DOC_ID\nand e.ENT_MPHONE <> '''' and p.PAT_NoSMS = 0\nand (DATEADD(dd, 0, DATEDIFF(dd, 0, a1.APT_BEGIN)) = @AppointmentDate\nand a1.APT_BEGIN > @AppointmentTime\nand a1.APT_BEGIN <= @AppointmentTime + @Horizon\n)\nand \na1.APT_PAT_ID NOT IN (select a2.APT_PAT_ID from APPOINTMENT a2\nWHERE a2.APT_PAT_ID = a1.APT_PAT_ID\nAND a2.APT_DOC_ID <> a1.APT_DOC_ID\nAND DATEADD(dd, 0, DATEDIFF(dd, 0, a2.APT_BEGIN)) = DATEADD(dd, 0, DATEDIFF(dd, 0, a1.APT_BEGIN))\nAND a2.APT_BEGIN < a1.APT_BEGIN\n)\nORDER BY a1.APT_BEGIN', 0, '', '');

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
